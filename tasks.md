# 実装タスク一覧

※ フェーズ1〜6が対人対戦MVPの完成ライン、フェーズ7以降はポストMVP拡張。

## フェーズ1: プロジェクト初期設定
- [x] Phoenix + LiveView プロジェクトの新規作成 (`mix phx.new .`)
- [x] `.formatter.exs` と `mix.exs` の設定調整（Elixir バージョン、依存関係の確認）
- [x] `mix phx.gen.secret` で生成したシークレットの環境変数化
- [x] 開発用 `config/dev.exs` に LiveView デバッグ/コードリロード設定を追記
- [x] GitHub Actions など CI 用ワークフローの雛形追加（`mix format --check-formatted` と `mix test`）

## フェーズ2: ドメイン設計と基盤
- [x] 将棋盤・駒・手番・対局状態を表すドメインモデルの設計メモ作成
- [x] `ToukonAiShogi.Game` コンテキスト作成（局面管理、合法手検証は後回し）
- [x] 駒画像を Phoenix の静的ファイル（`priv/static/images/koma/`）へ配置・参照設定
- [x] 初期盤面を JSON/構造体で保持するモジュールの実装
- [x] 「リクエスト」判定のフロー仕様を文書化（後続実装の基準）

## フェーズ3: LiveView UI 基盤
- [x] `ToukonAiShogiWeb.BoardLive` の雛形実装（マウント時に初期盤面を描画）
- [x] 将棋盤 UI コンポーネント化（9x9 グリッド、ドラッグ＆ドロップのスタブ）
- [x] 手番表示・対局ステータスを LiveComponent で切り出し
- [x] 駒操作イベント（クリック→ドラッグ→ドロップ）を LiveView イベントとして受け取るスタブを実装
- [x] Tailwind などスタイル設定の導入可否を決定し、必要ならセットアップ

## フェーズ4: 対局ロジック（縁台ルール対応）
- [x] 任意移動を許容する駒移動処理（行き先バリデーションなし）
- [x] 「成／不成」の選択ダイアログと状態反映
- [x] 「参りました」アクションの実装（対局終了・勝者表示）
- [x] 「リクエスト」ボタンの実装と結果ダイアログ（判定ロジックは仮実装でも可）
- [x] 相手3段目突入時の自動プロンプト処理

## フェーズ5: 対人対戦機能仕上げ
- [x] `mix phx.gen.auth` を用いたアカウント登録・ログイン機能導入
- [x] ロビー LiveView を実装し、入室プレイヤー一覧を表示
- [x] 2 人揃った時点で対局部屋を生成するマッチングロジック
- [x] Phoenix.PubSub を使った対局状態のブロードキャスト共有
- [x] Presence もしくはセッション管理による参加者トラッキングと再接続処理
- [x] 対局結果の永続化テーブル設計（勝敗記録の保存）
- [x] 将来的なレーティング算出用フィールドをスキーマに準備

### フェーズ5-1: 対局体験の最終調整
- [x] 後手参加時は盤面と駒表示を 180 度回転し、視点を後手基準に合わせる
- [x] 持ち駒を表示する駒台 UI と、持ち駒から任意マスへ打つ操作フローを実装する
- [x] 筋・段の表記を将棋ルール準拠（1筋→9筋／一段→九段）へ統一し、UI・ログ・棋譜出力に反映する。先手で説明すると、右から左へ1筋→9筋となる。上から下へ一段→九段となる。後手盤もこの表記は変わらない。念の為説明すると、後手番の場合は右から左へ9筋→1筋となり、上から下へ九段→一段となる。
- [x] 筋と段を盤の欄外に表示するようにする。筋は上側、段は右側に表示する。
  - 先手の場合は以下のようになる
        ```
        9 8 7 6 5 4 3 2 1
                          一
                          二
                          三
                          四
                          五
                          六
                          七
                          八
                          九
        ```
  - 後手の場合は以下のようになる
        ```
        1 2 3 4 5 6 7 8 9
                          九
                          八
                          七
                          六
                          五
                          四
                          三
                          二
                          一
        ```
- [ ] 駒台は自分の右下側に表示する。駒の向きは頭が相手の方を向いているように配置する。先手で言えば、相手の駒台は左上に表示されて、駒の頭が自分の方を向いている表示になる。
- [x] 盤の茶色の太線は不要。見にくい。全部同じ太さの線でよい。
- [ ] 指し手のキャンセルを実装したい。自分の駒をリリースする前に、自分の駒を触った場合は最後にさわったこまを動かす候補とする。

## フェーズ6: MVP 品質担保
- [ ] ドメインモジュールの ExUnit テスト（初期盤面、対局ステータス遷移）
- [ ] LiveView インタラクションのテスト（`Phoenix.LiveViewTest`）
- [ ] テストデータファクトリ（`ExMachina` など）導入検討
- [ ] `mix test --cover` でカバレッジ確認と閾値設定
- [ ] CI での自動テスト実行確認
- [ ] 棋譜保存のMVP実装（各対局が終了後に指し手リストを JSON などで保存）

## フェーズ7: ポストMVP拡張
- [ ] 棋譜保存フォーマットの検討（PGN / CSA / KIF などの比較と採用方針）
- [ ] コンピュータ対戦のための AI インターフェース設計
- [ ] 「入玉宣言法」対応ロジックの設計メモ作成
- [ ] ド派手な演出用アニメーション方針の検討
